<!DOCTYPE html>

<html lang="de">
<head>
<title>Version-check page of Seb's extension</title>
<script src="https://m2k3k5.github.io/extensions/latestversion.js"></script>
<link rel="stylesheet" href="client.css">
<link rel="shortcut icon" href="https://raw.githubusercontent.com/M2K3K5/home/gh-pages/web_icon.png"/>
<style>
    body {background-color:#555;}
    a {text-decoration: none;}
</style>
</head>

<body>

<p>Your version: <span id="currentVersionText">undefined</span></p>
<p>Latest version: <span id="latestVersionText">undefined</span></p>
<p id="statusP">Status: <span id="statusText">undefined</span></p>
<button onClick="stoppen()" id="btn1">Stop</button>

<script>
var currentVersion = 1.4;
var latestVersion;
var interval;
var checks = 0;
window.onload = function() {interval = setInterval(getLatestVersion, 1000);}

function stoppen() {clearInterval(interval);}

function getLatestVersion() 
{
    console.log("---------------New version check--------------------------------------------------------------------------------------------");
    /*
    console.log(document.head.outerHTML);
    var h = document.getElementsByTagName("head")[0];
    h.getElementsByTagName("script")[0].outerHTML = "";
    //var s = document.createElement("SCRIPT");
    var random = Math.floor((Math.random() * 999) + 1);
    var url = "https://m2k3k5.github.io/extensions/latestversion.js" + "?callback=" + random;
    //s.setAttribute("src", "url");
    h.innerHTML += '';
    console.log(url);
    console.log("version got checked");
    console.log(document.getElementsByTagName("html")[0].outerHTML);
    */
    checks++;
    if(checks > 120) {window.location.href = window.location.href;}
    document.getElementById("btn1").innerHTML = "Stop: " + checks;
    var h = document.getElementsByTagName("head")[0];
    console.log(h.getElementsByTagName("script")[0].outerHTML);
    var before = h.getElementsByTagName("script")[0].outerHTML;
    var scriptsBefore = h.getElementsByTagName("script").length;
    console.log("before: "+scriptsBefore);
    for (var i = 0; i < scriptsBefore ; i++)
        {
            h.getElementsByTagName("script")[i].outerHTML = "";
        }
    var scriptsAfter = h.getElementsByTagName("script").length;
    console.log("after: "+scriptsAfter);
    h.innerHTML += before;
    var random = Math.floor((Math.random() * 99999) + 1);
    var url = "https://m2k3k5.github.io/extensions/latestversion.js" + "?" + random;
    h.getElementsByTagName("script")[0].setAttribute("src", url);
    var scriptsNow = h.getElementsByTagName("script").length;
    console.log("now: "+scriptsNow);
    console.log("version got checked");
}

if(latestVersion == undefined || currentVersion == undefined) 
{
        var x = document.getElementById("statusText");
         x.innerHTML = "ERROR! Please check out the website...!";
         x.style.color = "red";  
         var a = document.createElement("A");
         document.getElementById("statusP").appendChild(a);
         a.appendChild(x);
         x.style.borderBottom = "solid thin red";
         a.setAttribute("href", "https://m2k3k5.github.io/extensions/");
}
else 
{
document.getElementById("currentVersionText").innerHTML = currentVersion;
document.getElementById("latestVersionText").innerHTML = latestVersion;
if(currentVersion == latestVersion) {
    document.getElementById("statusText").innerHTML = "Ok!";
    document.getElementById("statusText").style.color = "#4ee44e";
    }
   else if(currentVersion > latestVersion) {
    document.getElementById("statusText").innerHTML = "Uhm... what!?";
    document.getElementById("statusText").style.color = "#4ee44e";
    }
  else {
         var x = document.getElementById("statusText");
         x.innerHTML = "Please update!";
         x.style.color = "yellow";  
         var a = document.createElement("A");
         document.getElementById("statusP").appendChild(a);
         a.appendChild(x);
         x.style.borderBottom = "solid thin yellow";
         a.setAttribute("href", "https://m2k3k5.github.io/extensions/");
         }
}

</script>

</body>
</html>
